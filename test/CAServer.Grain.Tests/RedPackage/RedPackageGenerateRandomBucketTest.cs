using CAServer.Grains.Grain.RedPackage;
using CAServer.Grains.State.RedPackage;
using CAServer.RedPackage.Dtos;
using Xunit;

namespace CAServer.Grain.Tests.RedPackage;

public class RedPackageGenerateRandomBucketTest
{
    [Fact]
    public async Task CreateRedPackage_test()
    {

        var input = new SendRedPackageInputDto()
        {
            Id = Guid.Parse("7c5b3068-89e9-4c1b-a19a-8cd0209c38ff"),
            TotalAmount = "6",
            Type =  RedPackageType.Random, 
            Memo = "Best wishes!",
            Symbol = "ELF",
            Count = 2,
            ChainId  = "AELF",
            ChannelUuid = "96d20bef98fd4c969e1de4e06038397b",
            RawTransaction = "0a220a2007abe74347e472bce1355502cf6011c2f943d3c9abf780e95d94cbcb8ab9ccf412220a20e28c0b6c4145f3534431326f3c6d5a4bd6006632fd7551c26c103c368855531618e18dc01822044504df4a2a124d616e61676572466f727761726443616c6c32c7030a220a20f231d29369811fcaa28dc3d3441aca07252a1193c464efeede7a964ed304333012220a20f5c8815048f438c59da895dd19c420e8d987931583a577049ccf1b3aa62b54e11a0f4372656174655265645061636b657422eb020a2430393236626630632d653033652d346364632d393939312d6233653964363063616335321203454c461880ade2042001288c9286f2c33130013802428201303434306433346438386539616637326135633964393762313538663832376465333534643763656464393539316565633835653364326430383538336335396232306231613462366631626535623938356162353832353865356536653930653262663030613139306437386237333835613630666465613332623734326534314a82016436346137643762366465626132333832366235616263313038343833643139386536643630356665303339333063363330613864353935373966373130616637653137303538303131336435383439656265613137313431383239636232303664323939333962646235313662656135336339393134323437393738663634303152220a208fda33eabbdf7a8e4981280bdfe8189bb0792f08c5c67493edaf3c83d61dcf1682f1044123ee532d03af64b0ab53554c93bb115d7bb7271572296e7ed301d4e56f6d74be011a9557af246d10ca48b47dc07f5c8bd505bac11b34b59fffc438b9ce3e911801",
            Message = ""
        };
        var (bucketList, luckyKingIndex)= new CryptoBoxGrain(null).GenerateBucket(input.Count, long.Parse(input.TotalAmount), 1, 8, input.Type);
        long amount = 0;
        foreach (BucketItem item in bucketList)
        {
            Assert.NotEqual(0, item.Amount);
            amount += item.Amount;
        }
        Assert.Equal(input.TotalAmount, amount.ToString());
    }
}