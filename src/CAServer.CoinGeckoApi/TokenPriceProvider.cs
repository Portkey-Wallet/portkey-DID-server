using System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Threading.Tasks;
using CAServer.Commons;
using CAServer.Signature.Options;
using CAServer.Signature.Provider;
using CAServer.Tokens.TokenPrice;
using CoinGecko.Clients;
using CoinGecko.Entities.Response.Coins;
using CoinGecko.Entities.Response.Search;
using CoinGecko.Interfaces;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.Options;
using Newtonsoft.Json;
using Volo.Abp.DependencyInjection;
using Volo.Abp.Threading;

namespace CAServer.CoinGeckoApi;

public class TokenPriceProvider : ITokenPriceProvider, ITransientDependency
{
    private readonly ILogger<TokenPriceProvider> _logger;
    private readonly ICoinGeckoClient _coinGeckoClient;
    private readonly IRequestLimitProvider _requestLimitProvider;
    private readonly IOptionsMonitor<CoinGeckoOptions> _coinGeckoOptions;
    private readonly IOptionsMonitor<SignatureServerOptions> _signatureOptions;
    private readonly ISecretProvider _secretProvider;

    private const string UsdSymbol = "usd";

    public TokenPriceProvider(IRequestLimitProvider requestLimitProvider, IOptionsMonitor<CoinGeckoOptions> options,
        IHttpClientFactory httpClientFactory, ISecretProvider secretProvider,
        IOptionsMonitor<SignatureServerOptions> signatureOptions, ILogger<TokenPriceProvider> logger)
    {
        _requestLimitProvider = requestLimitProvider;
        _coinGeckoOptions = options;
        _secretProvider = secretProvider;
        _signatureOptions = signatureOptions;
        _logger = logger;
        _coinGeckoClient = new CoinGeckoClient(InitCoinGeckoClient(httpClientFactory));
    }

    private HttpClient InitCoinGeckoClient(IHttpClientFactory httpClientFactory)
    {
        var apiKey = AsyncHelper.RunSync(() =>
            _secretProvider.GetSecretWithCacheAsync(_signatureOptions.CurrentValue.KeyIds.CoinGecko));
        var httpClient = httpClientFactory.CreateClient();
        httpClient.DefaultRequestHeaders.Add("Accept", "application/json");
        if (_coinGeckoOptions.CurrentValue.Timeout > 0)
        {
            httpClient.Timeout = TimeSpan.FromMilliseconds(_coinGeckoOptions.CurrentValue.Timeout);
        }

        if (_coinGeckoOptions.CurrentValue.BaseUrl.NotNullOrEmpty())
        {
            httpClient.BaseAddress = new Uri(_coinGeckoOptions.CurrentValue.BaseUrl);
        }

        if ((_coinGeckoOptions.CurrentValue.BaseUrl ?? "").Contains("pro"))
        {
            httpClient.DefaultRequestHeaders.Add("x-cg-pro-api-key", apiKey);
        }
        else if (!_coinGeckoOptions.CurrentValue.DemoApiKey.IsNullOrWhiteSpace())
        {
            // test environment uses the demo api-key
            httpClient.DefaultRequestHeaders.Add("x-cg-demo-api-key", _coinGeckoOptions.CurrentValue.DemoApiKey);
        }

        return httpClient;
    }

    public async Task<decimal> GetPriceAsync(string symbol)
    {
        if (string.IsNullOrEmpty(symbol))
        {
            return 0;
        }

        var coinId = GetCoinIdAsync(symbol);
        if (coinId == null)
        {
            _logger.LogWarning("Can not get the token {Symbol}", symbol);
            return 0;
        }

        try
        {
            var coinData =
                await RequestAsync(async () =>
                    await _coinGeckoClient.SimpleClient.GetSimplePrice(new[] { coinId }, new[] { UsdSymbol }));
            _logger.LogDebug("Get coinGecko data: {Price}", JsonConvert.SerializeObject(coinData));
            if (!coinData.TryGetValue(coinId, out var value))
            {
                return 0;
            }

            return value[UsdSymbol].Value;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Can not get current price from 'CoinGecko' :{Symbol}", symbol);
            throw;
        }
    }

    public async Task<Dictionary<string, decimal>> GetPriceAsync(params string[] symbols)
    {
        if (symbols.IsNullOrEmpty())
        {
            return null;
        }

        var prices = new Dictionary<string, decimal>();
        foreach (var symbol in symbols)
        {
            var price = await GetPriceAsync(symbol);
            if (price != 0)
            {
                prices.Add(symbol, price);
            }
        }

        return prices;
    }

    public async Task<decimal> GetHistoryPriceAsync(string symbol, string dateTime)
    {
        if (string.IsNullOrEmpty(symbol))
        {
            return 0;
        }

        var coinId = GetCoinIdAsync(symbol);
        if (coinId == null)
        {
            _logger.LogWarning("Can not get the token {Symbol}", symbol);
            return 0;
        }

        try
        {
            var coinData =
                await RequestAsync(async () => await _coinGeckoClient.CoinsClient.GetHistoryByCoinId(coinId,
                    dateTime, "false"));
            
            if (coinData.MarketData == null)
            {
                _logger.LogError("get history price error: {symbol}, {dateTime}", symbol, dateTime);
                return 0;
            }

            return (decimal)coinData.MarketData.CurrentPrice[UsdSymbol].Value;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Can not get :{Symbol} price", symbol);
            throw;
        }
    }

    public bool IsAvailable()
    {
        return _coinGeckoOptions.CurrentValue.IsAvailable;
    }

    public int GetPriority()
    {
        return _coinGeckoOptions.CurrentValue.Priority;
    }

    private string GetCoinIdAsync(string symbol)
    {
        return _coinGeckoOptions.CurrentValue.CoinIdMapping.TryGetValue(symbol.ToUpper(), out var id) ? id : null;
    }

    private async Task<T> RequestAsync<T>(Func<Task<T>> task)
    {
        await _requestLimitProvider.RecordRequestAsync();
        return await task();
    }
    
    public async Task<List<CoinMarkets>> GetHotListingsAsync()
    {
        List<CoinMarkets> response;
        try
        {
            response = await _coinGeckoClient.CoinsClient.GetCoinMarkets(UsdSymbol);
        }
        catch (Exception e)
        {
            _logger.LogError(e, "Can not get hot listings");
            response = JsonConvert.DeserializeObject<List<CoinMarkets>>("[{\"id\":\"bitcoin\",\"symbol\":\"btc\",\"name\":\"Bitcoin\",\"image\":\"https://assets.coingecko.com/coins/images/1/large/bitcoin.png?1696501400\",\"current_price\":67876,\"market_cap\":1335452835375,\"market_cap_rank\":1,\"fully_diluted_valuation\":1423216425036,\"total_volume\":27870003457,\"high_24h\":68880,\"low_24h\":67201,\"price_change_24h\":-476.55591137497686,\"price_change_percentage_24h\":-0.69721,\"market_cap_change_24h\":-9652483539.07544,\"market_cap_change_percentage_24h\":-0.7176,\"circulating_supply\":19705021.0,\"total_supply\":21000000.0,\"max_supply\":21000000.0,\"ath\":73738,\"ath_change_percentage\":-8.09044,\"ath_date\":\"2024-03-14T07:10:36.635Z\",\"atl\":67.81,\"atl_change_percentage\":99845.74572,\"atl_date\":\"2013-07-06T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:36.678Z\"},{\"id\":\"ethereum\",\"symbol\":\"eth\",\"name\":\"Ethereum\",\"image\":\"https://assets.coingecko.com/coins/images/279/large/ethereum.png?1696501628\",\"current_price\":3806.0,\"market_cap\":457404341484,\"market_cap_rank\":2,\"fully_diluted_valuation\":457404341484,\"total_volume\":17615531814,\"high_24h\":3927.72,\"low_24h\":3774.69,\"price_change_24h\":-78.32565575508852,\"price_change_percentage_24h\":-2.01645,\"market_cap_change_24h\":-9909542184.30066,\"market_cap_change_percentage_24h\":-2.12053,\"circulating_supply\":120138396.927761,\"total_supply\":120138396.927761,\"max_supply\":null,\"ath\":4878.26,\"ath_change_percentage\":-22.0958,\"ath_date\":\"2021-11-10T14:24:19.604Z\",\"atl\":0.432979,\"atl_change_percentage\":877626.45866,\"atl_date\":\"2015-10-20T00:00:00.000Z\",\"roi\":{\"times\":74.00346397006687,\"currency\":\"btc\",\"percentage\":7400.346397006688},\"last_updated\":\"2024-05-29T10:01:41.909Z\"},{\"id\":\"tether\",\"symbol\":\"usdt\",\"name\":\"Tether\",\"image\":\"https://assets.coingecko.com/coins/images/325/large/Tether.png?1696501661\",\"current_price\":0.998613,\"market_cap\":111865680874,\"market_cap_rank\":3,\"fully_diluted_valuation\":111865680874,\"total_volume\":33680794862,\"high_24h\":1.001,\"low_24h\":0.993144,\"price_change_24h\":0.00019382,\"price_change_percentage_24h\":0.01941,\"market_cap_change_24h\":-19094177.474700928,\"market_cap_change_percentage_24h\":-0.01707,\"circulating_supply\":111962821346.452,\"total_supply\":111962821346.452,\"max_supply\":null,\"ath\":1.32,\"ath_change_percentage\":-24.52449,\"ath_date\":\"2018-07-24T00:00:00.000Z\",\"atl\":0.572521,\"atl_change_percentage\":74.42382,\"atl_date\":\"2015-03-02T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:00:22.513Z\"},{\"id\":\"binancecoin\",\"symbol\":\"bnb\",\"name\":\"BNB\",\"image\":\"https://assets.coingecko.com/coins/images/825/large/bnb-icon2_2x.png?1696501970\",\"current_price\":599.32,\"market_cap\":92208960553,\"market_cap_rank\":4,\"fully_diluted_valuation\":92208960553,\"total_volume\":907878932,\"high_24h\":606.11,\"low_24h\":593.55,\"price_change_24h\":-1.3147670109462979,\"price_change_percentage_24h\":-0.2189,\"market_cap_change_24h\":-210183946.4457245,\"market_cap_change_percentage_24h\":-0.22742,\"circulating_supply\":153856150.0,\"total_supply\":153856150.0,\"max_supply\":200000000.0,\"ath\":686.31,\"ath_change_percentage\":-12.81816,\"ath_date\":\"2021-05-10T07:24:17.097Z\",\"atl\":0.0398177,\"atl_change_percentage\":1502585.42504,\"atl_date\":\"2017-10-19T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:01.159Z\"},{\"id\":\"solana\",\"symbol\":\"sol\",\"name\":\"Solana\",\"image\":\"https://assets.coingecko.com/coins/images/4128/large/solana.png?1696504756\",\"current_price\":168.76,\"market_cap\":77552144436,\"market_cap_rank\":5,\"fully_diluted_valuation\":97372110177,\"total_volume\":2948050472,\"high_24h\":173.27,\"low_24h\":165.87,\"price_change_24h\":0.779476,\"price_change_percentage_24h\":0.46402,\"market_cap_change_24h\":2279316786,\"market_cap_change_percentage_24h\":3.02807,\"circulating_supply\":459506541.402024,\"total_supply\":576942415.990744,\"max_supply\":null,\"ath\":259.96,\"ath_change_percentage\":-35.2377,\"ath_date\":\"2021-11-06T21:54:35.825Z\",\"atl\":0.500801,\"atl_change_percentage\":33517.24982,\"atl_date\":\"2020-05-11T19:35:23.449Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:33.286Z\"},{\"id\":\"staked-ether\",\"symbol\":\"steth\",\"name\":\"Lido Staked Ether\",\"image\":\"https://assets.coingecko.com/coins/images/13442/large/steth_logo.png?1696513206\",\"current_price\":3801.86,\"market_cap\":35936391830,\"market_cap_rank\":6,\"fully_diluted_valuation\":35936391830,\"total_volume\":98495135,\"high_24h\":3914.34,\"low_24h\":3777.37,\"price_change_24h\":-75.97646012626365,\"price_change_percentage_24h\":-1.95925,\"market_cap_change_24h\":-149019502.66591644,\"market_cap_change_percentage_24h\":-0.41296,\"circulating_supply\":9446041.74539237,\"total_supply\":9446041.74539237,\"max_supply\":null,\"ath\":4829.57,\"ath_change_percentage\":-21.28237,\"ath_date\":\"2021-11-10T14:40:47.256Z\",\"atl\":482.9,\"atl_change_percentage\":687.27552,\"atl_date\":\"2020-12-22T04:08:21.854Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:27.538Z\"},{\"id\":\"usd-coin\",\"symbol\":\"usdc\",\"name\":\"USDC\",\"image\":\"https://assets.coingecko.com/coins/images/6319/large/usdc.png?1696506694\",\"current_price\":1.001,\"market_cap\":32317832689,\"market_cap_rank\":7,\"fully_diluted_valuation\":32371541691,\"total_volume\":6721998648,\"high_24h\":1.003,\"low_24h\":0.995832,\"price_change_24h\":0.0017065,\"price_change_percentage_24h\":0.17074,\"market_cap_change_24h\":-155871949.99237823,\"market_cap_change_percentage_24h\":-0.47999,\"circulating_supply\":32282506489.5472,\"total_supply\":32336156782.3535,\"max_supply\":null,\"ath\":1.17,\"ath_change_percentage\":-14.62565,\"ath_date\":\"2019-05-08T00:40:28.300Z\",\"atl\":0.877647,\"atl_change_percentage\":14.07669,\"atl_date\":\"2023-03-11T08:02:13.981Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:30.556Z\"},{\"id\":\"ripple\",\"symbol\":\"xrp\",\"name\":\"XRP\",\"image\":\"https://assets.coingecko.com/coins/images/44/large/xrp-symbol-white-128.png?1696501442\",\"current_price\":0.529415,\"market_cap\":29362533051,\"market_cap_rank\":8,\"fully_diluted_valuation\":52965250270,\"total_volume\":921883916,\"high_24h\":0.532405,\"low_24h\":0.521609,\"price_change_24h\":0.00272393,\"price_change_percentage_24h\":0.51718,\"market_cap_change_24h\":165577860,\"market_cap_change_percentage_24h\":0.56711,\"circulating_supply\":55430475754.0,\"total_supply\":99987593568.0,\"max_supply\":100000000000.0,\"ath\":3.4,\"ath_change_percentage\":-84.44523,\"ath_date\":\"2018-01-07T00:00:00.000Z\",\"atl\":0.00268621,\"atl_change_percentage\":19579.09727,\"atl_date\":\"2014-05-22T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:13.799Z\"},{\"id\":\"dogecoin\",\"symbol\":\"doge\",\"name\":\"Dogecoin\",\"image\":\"https://assets.coingecko.com/coins/images/5/large/dogecoin.png?1696501409\",\"current_price\":0.164431,\"market_cap\":23796562157,\"market_cap_rank\":9,\"fully_diluted_valuation\":23801995086,\"total_volume\":1331062964,\"high_24h\":0.170113,\"low_24h\":0.161872,\"price_change_24h\":-0.001642029393234573,\"price_change_percentage_24h\":-0.98874,\"market_cap_change_24h\":-189800186.85606384,\"market_cap_change_percentage_24h\":-0.79128,\"circulating_supply\":144454426383.705,\"total_supply\":144487406383.705,\"max_supply\":null,\"ath\":0.731578,\"ath_change_percentage\":-77.55583,\"ath_date\":\"2021-05-08T05:08:23.458Z\",\"atl\":8.69e-05,\"atl_change_percentage\":188840.78526,\"atl_date\":\"2015-05-06T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:25.517Z\"},{\"id\":\"the-open-network\",\"symbol\":\"ton\",\"name\":\"Toncoin\",\"image\":\"https://assets.coingecko.com/coins/images/17980/large/ton_symbol.png?1696517498\",\"current_price\":6.49,\"market_cap\":22618312865,\"market_cap_rank\":10,\"fully_diluted_valuation\":33242578879,\"total_volume\":190504228,\"high_24h\":6.56,\"low_24h\":6.36,\"price_change_24h\":0.076252,\"price_change_percentage_24h\":1.1885,\"market_cap_change_24h\":214754251,\"market_cap_change_percentage_24h\":0.95857,\"circulating_supply\":3474856201.03625,\"total_supply\":5107064441.2932,\"max_supply\":null,\"ath\":7.63,\"ath_change_percentage\":-14.79072,\"ath_date\":\"2024-04-11T05:55:53.682Z\",\"atl\":0.519364,\"atl_change_percentage\":1152.50618,\"atl_date\":\"2021-09-21T00:33:11.092Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:49.549Z\"},{\"id\":\"cardano\",\"symbol\":\"ada\",\"name\":\"Cardano\",\"image\":\"https://assets.coingecko.com/coins/images/975/large/cardano.png?1696502090\",\"current_price\":0.462105,\"market_cap\":16347188989,\"market_cap_rank\":11,\"fully_diluted_valuation\":20794747341,\"total_volume\":322282559,\"high_24h\":0.463274,\"low_24h\":0.452005,\"price_change_24h\":0.0038128,\"price_change_percentage_24h\":0.83196,\"market_cap_change_24h\":131272465,\"market_cap_change_percentage_24h\":0.80953,\"circulating_supply\":35375448061.3403,\"total_supply\":45000000000.0,\"max_supply\":45000000000.0,\"ath\":3.09,\"ath_change_percentage\":-85.05068,\"ath_date\":\"2021-09-02T06:00:10.474Z\",\"atl\":0.01925275,\"atl_change_percentage\":2296.91654,\"atl_date\":\"2020-03-13T02:22:55.044Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:15.172Z\"},{\"id\":\"shiba-inu\",\"symbol\":\"shib\",\"name\":\"Shiba Inu\",\"image\":\"https://assets.coingecko.com/coins/images/11939/large/shiba.png?1696511800\",\"current_price\":2.745e-05,\"market_cap\":16217841527,\"market_cap_rank\":12,\"fully_diluted_valuation\":27521763236,\"total_volume\":2222734172,\"high_24h\":2.927e-05,\"low_24h\":2.503e-05,\"price_change_24h\":2.42e-06,\"price_change_percentage_24h\":9.65728,\"market_cap_change_24h\":1447944910,\"market_cap_change_percentage_24h\":9.80335,\"circulating_supply\":589262950027294.6,\"total_supply\":999982356930626.0,\"max_supply\":null,\"ath\":8.616e-05,\"ath_change_percentage\":-68.13335,\"ath_date\":\"2021-10-28T03:54:55.568Z\",\"atl\":5.6366e-11,\"atl_change_percentage\":48709633.34239,\"atl_date\":\"2020-11-28T11:26:25.838Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:48.467Z\"},{\"id\":\"avalanche-2\",\"symbol\":\"avax\",\"name\":\"Avalanche\",\"image\":\"https://assets.coingecko.com/coins/images/12559/large/Avalanche_Circle_RedWhite_Trans.png?1696512369\",\"current_price\":36.89,\"market_cap\":14473756653,\"market_cap_rank\":13,\"fully_diluted_valuation\":16291504764,\"total_volume\":421673266,\"high_24h\":37.45,\"low_24h\":36.43,\"price_change_24h\":-0.16281057042651526,\"price_change_percentage_24h\":-0.43939,\"market_cap_change_24h\":-85808335.13398552,\"market_cap_change_percentage_24h\":-0.58936,\"circulating_supply\":392918340.98878,\"total_supply\":442264657.149636,\"max_supply\":720000000.0,\"ath\":144.96,\"ath_change_percentage\":-74.58476,\"ath_date\":\"2021-11-21T14:18:56.538Z\",\"atl\":2.8,\"atl_change_percentage\":1215.29422,\"atl_date\":\"2020-12-31T13:15:21.540Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:19.202Z\"},{\"id\":\"chainlink\",\"symbol\":\"link\",\"name\":\"Chainlink\",\"image\":\"https://assets.coingecko.com/coins/images/877/large/chainlink-new-logo.png?1696502009\",\"current_price\":18.45,\"market_cap\":10830720707,\"market_cap_rank\":14,\"fully_diluted_valuation\":18447830414,\"total_volume\":589701668,\"high_24h\":18.56,\"low_24h\":17.9,\"price_change_24h\":0.265436,\"price_change_percentage_24h\":1.45985,\"market_cap_change_24h\":156658884,\"market_cap_change_percentage_24h\":1.46766,\"circulating_supply\":587099971.3083414,\"total_supply\":1000000000.0,\"max_supply\":1000000000.0,\"ath\":52.7,\"ath_change_percentage\":-65.03258,\"ath_date\":\"2021-05-10T00:13:57.214Z\",\"atl\":0.148183,\"atl_change_percentage\":12335.04139,\"atl_date\":\"2017-11-29T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:46.708Z\"},{\"id\":\"wrapped-bitcoin\",\"symbol\":\"wbtc\",\"name\":\"Wrapped Bitcoin\",\"image\":\"https://assets.coingecko.com/coins/images/7598/large/wrapped_bitcoin_wbtc.png?1696507857\",\"current_price\":67861,\"market_cap\":10542448078,\"market_cap_rank\":15,\"fully_diluted_valuation\":10542448078,\"total_volume\":220876056,\"high_24h\":68925,\"low_24h\":67500,\"price_change_24h\":-436.8616929751879,\"price_change_percentage_24h\":-0.63964,\"market_cap_change_24h\":-47940749.3785305,\"market_cap_change_percentage_24h\":-0.45268,\"circulating_supply\":155254.86374143,\"total_supply\":155254.86374143,\"max_supply\":155254.86374143,\"ath\":73505,\"ath_change_percentage\":-7.73995,\"ath_date\":\"2024-03-14T07:10:23.403Z\",\"atl\":3139.17,\"atl_change_percentage\":2060.32057,\"atl_date\":\"2019-04-02T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:00:36.299Z\"},{\"id\":\"polkadot\",\"symbol\":\"dot\",\"name\":\"Polkadot\",\"image\":\"https://assets.coingecko.com/coins/images/12171/large/polkadot.png?1696512008\",\"current_price\":7.41,\"market_cap\":10180669688,\"market_cap_rank\":16,\"fully_diluted_valuation\":10782352851,\"total_volume\":229176437,\"high_24h\":7.54,\"low_24h\":7.28,\"price_change_24h\":-0.003460036085004781,\"price_change_percentage_24h\":-0.0467,\"market_cap_change_24h\":25168306,\"market_cap_change_percentage_24h\":0.24783,\"circulating_supply\":1369662910.11566,\"total_supply\":1450610739.37943,\"max_supply\":null,\"ath\":54.98,\"ath_change_percentage\":-86.47761,\"ath_date\":\"2021-11-04T14:10:09.301Z\",\"atl\":2.7,\"atl_change_percentage\":175.62014,\"atl_date\":\"2020-08-20T05:48:11.359Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:58.186Z\"},{\"id\":\"tron\",\"symbol\":\"trx\",\"name\":\"TRON\",\"image\":\"https://assets.coingecko.com/coins/images/1094/large/tron-logo.png?1696502193\",\"current_price\":0.111507,\"market_cap\":9754173447,\"market_cap_rank\":17,\"fully_diluted_valuation\":9754209590,\"total_volume\":330869863,\"high_24h\":0.111883,\"low_24h\":0.110327,\"price_change_24h\":0.00036842,\"price_change_percentage_24h\":0.3315,\"market_cap_change_24h\":49766215,\"market_cap_change_percentage_24h\":0.51282,\"circulating_supply\":87392827812.8282,\"total_supply\":87393151640.1941,\"max_supply\":null,\"ath\":0.231673,\"ath_change_percentage\":-51.94785,\"ath_date\":\"2018-01-05T00:00:00.000Z\",\"atl\":0.00180434,\"atl_change_percentage\":6069.77069,\"atl_date\":\"2017-11-12T00:00:00.000Z\",\"roi\":{\"times\":57.68772345212721,\"currency\":\"usd\",\"percentage\":5768.772345212721},\"last_updated\":\"2024-05-29T10:01:13.562Z\"},{\"id\":\"bitcoin-cash\",\"symbol\":\"bch\",\"name\":\"Bitcoin Cash\",\"image\":\"https://assets.coingecko.com/coins/images/780/large/bitcoin-cash-circle.png?1696501932\",\"current_price\":468.19,\"market_cap\":9229067746,\"market_cap_rank\":18,\"fully_diluted_valuation\":9832033333,\"total_volume\":263983360,\"high_24h\":475.79,\"low_24h\":460.88,\"price_change_24h\":-4.0060057135312945,\"price_change_percentage_24h\":-0.84837,\"market_cap_change_24h\":-85891259.67516899,\"market_cap_change_percentage_24h\":-0.92208,\"circulating_supply\":19712140.5216508,\"total_supply\":21000000.0,\"max_supply\":21000000.0,\"ath\":3785.82,\"ath_change_percentage\":-87.63093,\"ath_date\":\"2017-12-20T00:00:00.000Z\",\"atl\":76.93,\"atl_change_percentage\":508.6593,\"atl_date\":\"2018-12-16T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:00:57.970Z\"},{\"id\":\"near\",\"symbol\":\"near\",\"name\":\"NEAR Protocol\",\"image\":\"https://assets.coingecko.com/coins/images/10365/large/near.jpg?1696510367\",\"current_price\":7.73,\"market_cap\":8371312499,\"market_cap_rank\":19,\"fully_diluted_valuation\":9169039551,\"total_volume\":397683122,\"high_24h\":7.92,\"low_24h\":7.54,\"price_change_24h\":-0.17082408163683382,\"price_change_percentage_24h\":-2.16185,\"market_cap_change_24h\":-207068319.03542042,\"market_cap_change_percentage_24h\":-2.41384,\"circulating_supply\":1080301093.91642,\"total_supply\":1183246170.6779,\"max_supply\":null,\"ath\":20.44,\"ath_change_percentage\":-62.19074,\"ath_date\":\"2022-01-16T22:09:45.873Z\",\"atl\":0.526762,\"atl_change_percentage\":1366.98056,\"atl_date\":\"2020-11-04T16:09:15.137Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:18.131Z\"},{\"id\":\"uniswap\",\"symbol\":\"uni\",\"name\":\"Uniswap\",\"image\":\"https://assets.coingecko.com/coins/images/12504/large/uni.jpg?1696512319\",\"current_price\":10.86,\"market_cap\":8189295519,\"market_cap_rank\":20,\"fully_diluted_valuation\":10864496770,\"total_volume\":329118294,\"high_24h\":11.43,\"low_24h\":10.66,\"price_change_24h\":0.04131331,\"price_change_percentage_24h\":0.38186,\"market_cap_change_24h\":-3420135.441710472,\"market_cap_change_percentage_24h\":-0.04175,\"circulating_supply\":753766667.0,\"total_supply\":1000000000.0,\"max_supply\":1000000000.0,\"ath\":44.92,\"ath_change_percentage\":-75.89064,\"ath_date\":\"2021-05-03T05:25:04.822Z\",\"atl\":1.03,\"atl_change_percentage\":951.22902,\"atl_date\":\"2020-09-17T01:20:38.214Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:17.435Z\"},{\"id\":\"matic-network\",\"symbol\":\"matic\",\"name\":\"Polygon\",\"image\":\"https://assets.coingecko.com/coins/images/4713/large/polygon.png?1698233745\",\"current_price\":0.735544,\"market_cap\":6821235648,\"market_cap_rank\":21,\"fully_diluted_valuation\":7348138658,\"total_volume\":354765010,\"high_24h\":0.746474,\"low_24h\":0.717701,\"price_change_24h\":-0.001637562290120132,\"price_change_percentage_24h\":-0.22214,\"market_cap_change_24h\":16650501,\"market_cap_change_percentage_24h\":0.2447,\"circulating_supply\":9282943566.203985,\"total_supply\":10000000000.0,\"max_supply\":10000000000.0,\"ath\":2.92,\"ath_change_percentage\":-74.82093,\"ath_date\":\"2021-12-27T02:08:34.307Z\",\"atl\":0.00314376,\"atl_change_percentage\":23256.99474,\"atl_date\":\"2019-05-10T00:00:00.000Z\",\"roi\":{\"times\":278.67462657952615,\"currency\":\"usd\",\"percentage\":27867.462657952616},\"last_updated\":\"2024-05-29T10:01:29.798Z\"},{\"id\":\"pepe\",\"symbol\":\"pepe\",\"name\":\"Pepe\",\"image\":\"https://assets.coingecko.com/coins/images/29850/large/pepe-token.jpeg?1696528776\",\"current_price\":1.51e-05,\"market_cap\":6353981075,\"market_cap_rank\":22,\"fully_diluted_valuation\":6353981075,\"total_volume\":1495233613,\"high_24h\":1.69e-05,\"low_24h\":1.497e-05,\"price_change_24h\":-1.470021893152e-06,\"price_change_percentage_24h\":-8.8716,\"market_cap_change_24h\":-633537469.1316814,\"market_cap_change_percentage_24h\":-9.0667,\"circulating_supply\":420690000000000.0,\"total_supply\":420690000000000.0,\"max_supply\":420690000000000.0,\"ath\":1.717e-05,\"ath_change_percentage\":-12.42401,\"ath_date\":\"2024-05-27T08:30:07.709Z\",\"atl\":5.5142e-08,\"atl_change_percentage\":27162.94508,\"atl_date\":\"2023-04-18T02:14:41.591Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:19.522Z\"},{\"id\":\"litecoin\",\"symbol\":\"ltc\",\"name\":\"Litecoin\",\"image\":\"https://assets.coingecko.com/coins/images/2/large/litecoin.png?1696501400\",\"current_price\":83.42,\"market_cap\":6215474286,\"market_cap_rank\":23,\"fully_diluted_valuation\":7000258871,\"total_volume\":327167490,\"high_24h\":84.12,\"low_24h\":81.97,\"price_change_24h\":-0.2533314887543838,\"price_change_percentage_24h\":-0.30275,\"market_cap_change_24h\":-34317364.56068611,\"market_cap_change_percentage_24h\":-0.5491,\"circulating_supply\":74582933.2334713,\"total_supply\":84000000.0,\"max_supply\":84000000.0,\"ath\":410.26,\"ath_change_percentage\":-79.70556,\"ath_date\":\"2021-05-10T03:13:07.904Z\",\"atl\":1.15,\"atl_change_percentage\":7147.28843,\"atl_date\":\"2015-01-14T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:22.741Z\"},{\"id\":\"fetch-ai\",\"symbol\":\"fet\",\"name\":\"Fetch.ai\",\"image\":\"https://assets.coingecko.com/coins/images/5681/large/Fetch.jpg?1696506140\",\"current_price\":2.3,\"market_cap\":5860567038,\"market_cap_rank\":24,\"fully_diluted_valuation\":6115201196,\"total_volume\":196427614,\"high_24h\":2.32,\"low_24h\":2.2,\"price_change_24h\":0.04909595,\"price_change_percentage_24h\":2.17752,\"market_cap_change_24h\":157488763,\"market_cap_change_percentage_24h\":2.76147,\"circulating_supply\":2521012371.0,\"total_supply\":2630547141.0,\"max_supply\":2630547141.0,\"ath\":3.45,\"ath_change_percentage\":-33.30428,\"ath_date\":\"2024-03-28T17:21:18.050Z\",\"atl\":0.00816959,\"atl_change_percentage\":28099.31413,\"atl_date\":\"2020-03-13T02:24:18.347Z\",\"roi\":{\"times\":25.57173336299219,\"currency\":\"usd\",\"percentage\":2557.173336299219},\"last_updated\":\"2024-05-29T10:01:32.968Z\"},{\"id\":\"internet-computer\",\"symbol\":\"icp\",\"name\":\"Internet Computer\",\"image\":\"https://assets.coingecko.com/coins/images/14495/large/Internet_Computer_logo.png?1696514180\",\"current_price\":12.19,\"market_cap\":5694993350,\"market_cap_rank\":25,\"fully_diluted_valuation\":6364876509,\"total_volume\":86237468,\"high_24h\":12.33,\"low_24h\":11.92,\"price_change_24h\":-0.10486021046692606,\"price_change_percentage_24h\":-0.85306,\"market_cap_change_24h\":25535672,\"market_cap_change_percentage_24h\":0.45041,\"circulating_supply\":464357799.705726,\"total_supply\":518978665.892902,\"max_supply\":null,\"ath\":700.65,\"ath_change_percentage\":-98.25852,\"ath_date\":\"2021-05-10T16:05:53.653Z\",\"atl\":2.87,\"atl_change_percentage\":325.88381,\"atl_date\":\"2023-09-22T00:29:57.369Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:56.137Z\"},{\"id\":\"leo-token\",\"symbol\":\"leo\",\"name\":\"LEO Token\",\"image\":\"https://assets.coingecko.com/coins/images/8418/large/leo-token.png?1696508607\",\"current_price\":5.98,\"market_cap\":5539726450,\"market_cap_rank\":26,\"fully_diluted_valuation\":5892172712,\"total_volume\":1965941,\"high_24h\":5.99,\"low_24h\":5.81,\"price_change_24h\":0.00706311,\"price_change_percentage_24h\":0.11822,\"market_cap_change_24h\":12334425,\"market_cap_change_percentage_24h\":0.22315,\"circulating_supply\":926306407.9,\"total_supply\":985239504.0,\"max_supply\":null,\"ath\":8.14,\"ath_change_percentage\":-26.46068,\"ath_date\":\"2022-02-08T17:40:10.285Z\",\"atl\":0.799859,\"atl_change_percentage\":647.96619,\"atl_date\":\"2019-12-24T15:14:35.376Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:44.088Z\"},{\"id\":\"dai\",\"symbol\":\"dai\",\"name\":\"Dai\",\"image\":\"https://assets.coingecko.com/coins/images/9956/large/Badge_Dai.png?1696509996\",\"current_price\":0.99913,\"market_cap\":5317676290,\"market_cap_rank\":27,\"fully_diluted_valuation\":5317676290,\"total_volume\":282185172,\"high_24h\":1.002,\"low_24h\":0.994073,\"price_change_24h\":-3.273354055366e-06,\"price_change_percentage_24h\":-0.00033,\"market_cap_change_24h\":-12404139.174161911,\"market_cap_change_percentage_24h\":-0.23272,\"circulating_supply\":5320491050.29954,\"total_supply\":5320491050.29954,\"max_supply\":null,\"ath\":1.22,\"ath_change_percentage\":-18.00288,\"ath_date\":\"2020-03-13T03:02:50.373Z\",\"atl\":0.88196,\"atl_change_percentage\":13.32578,\"atl_date\":\"2023-03-11T07:50:50.514Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:00:23.405Z\"},{\"id\":\"wrapped-eeth\",\"symbol\":\"weeth\",\"name\":\"Wrapped eETH\",\"image\":\"https://assets.coingecko.com/coins/images/33033/large/weETH.png?1701438396\",\"current_price\":3955.3,\"market_cap\":4894021557,\"market_cap_rank\":28,\"fully_diluted_valuation\":4894021557,\"total_volume\":20960156,\"high_24h\":4073.43,\"low_24h\":3927.05,\"price_change_24h\":-76.40270188605291,\"price_change_percentage_24h\":-1.89505,\"market_cap_change_24h\":-59844594.96337128,\"market_cap_change_percentage_24h\":-1.20804,\"circulating_supply\":1238165.99212336,\"total_supply\":1238165.99212336,\"max_supply\":null,\"ath\":4196.87,\"ath_change_percentage\":-5.92617,\"ath_date\":\"2024-03-13T08:29:59.938Z\",\"atl\":2231.18,\"atl_change_percentage\":76.95419,\"atl_date\":\"2024-01-08T03:35:28.624Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:28.026Z\"},{\"id\":\"ethereum-classic\",\"symbol\":\"etc\",\"name\":\"Ethereum Classic\",\"image\":\"https://assets.coingecko.com/coins/images/453/large/ethereum-classic-logo.png?1696501717\",\"current_price\":30.7,\"market_cap\":4534583510,\"market_cap_rank\":29,\"fully_diluted_valuation\":6486676959,\"total_volume\":195000522,\"high_24h\":31.9,\"low_24h\":30.51,\"price_change_24h\":-0.754942462196027,\"price_change_percentage_24h\":-2.40029,\"market_cap_change_24h\":-102790542.26967716,\"market_cap_change_percentage_24h\":-2.21657,\"circulating_supply\":147292173.092388,\"total_supply\":210700000.0,\"max_supply\":210700000.0,\"ath\":167.09,\"ath_change_percentage\":-81.62666,\"ath_date\":\"2021-05-06T18:34:22.133Z\",\"atl\":0.615038,\"atl_change_percentage\":4891.42589,\"atl_date\":\"2016-07-25T00:00:00.000Z\",\"roi\":{\"times\":67.21585611686271,\"currency\":\"usd\",\"percentage\":6721.5856116862715},\"last_updated\":\"2024-05-29T10:00:50.437Z\"},{\"id\":\"aptos\",\"symbol\":\"apt\",\"name\":\"Aptos\",\"image\":\"https://assets.coingecko.com/coins/images/26455/large/aptos_round.png?1696525528\",\"current_price\":9.3,\"market_cap\":4053946703,\"market_cap_rank\":30,\"fully_diluted_valuation\":10203963376,\"total_volume\":201303439,\"high_24h\":9.63,\"low_24h\":9.23,\"price_change_24h\":-0.11335144563766875,\"price_change_percentage_24h\":-1.20364,\"market_cap_change_24h\":-49858207.124535084,\"market_cap_change_percentage_24h\":-1.21493,\"circulating_supply\":436296059.767557,\"total_supply\":1098176503.38247,\"max_supply\":null,\"ath\":19.92,\"ath_change_percentage\":-53.29188,\"ath_date\":\"2023-01-26T14:25:17.390Z\",\"atl\":3.08,\"atl_change_percentage\":202.1124,\"atl_date\":\"2022-12-29T21:35:14.796Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:59.585Z\"},{\"id\":\"render-token\",\"symbol\":\"rndr\",\"name\":\"Render\",\"image\":\"https://assets.coingecko.com/coins/images/11636/large/rndr.png?1696511529\",\"current_price\":10.25,\"market_cap\":3991835504,\"market_cap_rank\":31,\"fully_diluted_valuation\":5465000689,\"total_volume\":264012321,\"high_24h\":10.58,\"low_24h\":9.89,\"price_change_24h\":0.24157,\"price_change_percentage_24h\":2.41253,\"market_cap_change_24h\":95646946,\"market_cap_change_percentage_24h\":2.45488,\"circulating_supply\":388643961.00672,\"total_supply\":532070901.28672,\"max_supply\":532070901.28672,\"ath\":13.53,\"ath_change_percentage\":-24.21995,\"ath_date\":\"2024-03-17T16:30:24.636Z\",\"atl\":0.03665669,\"atl_change_percentage\":27880.15207,\"atl_date\":\"2020-06-16T13:22:25.900Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:32.218Z\"},{\"id\":\"hedera-hashgraph\",\"symbol\":\"hbar\",\"name\":\"Hedera\",\"image\":\"https://assets.coingecko.com/coins/images/3688/large/hbar.png?1696504364\",\"current_price\":0.106617,\"market_cap\":3816801820,\"market_cap_rank\":32,\"fully_diluted_valuation\":5338187130,\"total_volume\":63037859,\"high_24h\":0.107101,\"low_24h\":0.10284,\"price_change_24h\":0.00178127,\"price_change_percentage_24h\":1.6991,\"market_cap_change_24h\":70411190,\"market_cap_change_percentage_24h\":1.87944,\"circulating_supply\":35749981467.201,\"total_supply\":50000000000.0,\"max_supply\":50000000000.0,\"ath\":0.569229,\"ath_change_percentage\":-81.26646,\"ath_date\":\"2021-09-15T10:40:28.318Z\",\"atl\":0.00986111,\"atl_change_percentage\":981.38638,\"atl_date\":\"2020-01-02T17:30:24.852Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:59.124Z\"},{\"id\":\"dogwifcoin\",\"symbol\":\"wif\",\"name\":\"dogwifhat\",\"image\":\"https://assets.coingecko.com/coins/images/33566/large/dogwifhat.jpg?1702499428\",\"current_price\":3.75,\"market_cap\":3769906915,\"market_cap_rank\":33,\"fully_diluted_valuation\":3769906915,\"total_volume\":1315722808,\"high_24h\":4.05,\"low_24h\":3.56,\"price_change_24h\":0.180634,\"price_change_percentage_24h\":5.05483,\"market_cap_change_24h\":227421050,\"market_cap_change_percentage_24h\":6.41982,\"circulating_supply\":998926392.0,\"total_supply\":998926392.0,\"max_supply\":998926392.0,\"ath\":4.83,\"ath_change_percentage\":-22.57242,\"ath_date\":\"2024-03-31T09:34:58.366Z\",\"atl\":0.00155464,\"atl_change_percentage\":240228.26097,\"atl_date\":\"2023-12-13T07:13:50.873Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:20.771Z\"},{\"id\":\"renzo-restaked-eth\",\"symbol\":\"ezeth\",\"name\":\"Renzo Restaked ETH\",\"image\":\"https://assets.coingecko.com/coins/images/34753/large/Ezeth_logo_circle.png?1713496404\",\"current_price\":3771.71,\"market_cap\":3752655560,\"market_cap_rank\":34,\"fully_diluted_valuation\":3764098625,\"total_volume\":41707916,\"high_24h\":3879.53,\"low_24h\":3745.62,\"price_change_24h\":-72.59398320502305,\"price_change_percentage_24h\":-1.88835,\"market_cap_change_24h\":-84182931.44212246,\"market_cap_change_percentage_24h\":-2.19407,\"circulating_supply\":996928.060599325,\"total_supply\":999968.017915635,\"max_supply\":null,\"ath\":4106.74,\"ath_change_percentage\":-8.39881,\"ath_date\":\"2024-03-12T00:44:29.429Z\",\"atl\":2198.04,\"atl_change_percentage\":71.14453,\"atl_date\":\"2024-01-26T08:09:59.848Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:33.858Z\"},{\"id\":\"cosmos\",\"symbol\":\"atom\",\"name\":\"Cosmos Hub\",\"image\":\"https://assets.coingecko.com/coins/images/1481/large/cosmos_hub.png?1696502525\",\"current_price\":8.8,\"market_cap\":3439475689,\"market_cap_rank\":35,\"fully_diluted_valuation\":3441603221,\"total_volume\":246963186,\"high_24h\":8.86,\"low_24h\":8.55,\"price_change_24h\":0.173647,\"price_change_percentage_24h\":2.01353,\"market_cap_change_24h\":97772197,\"market_cap_change_percentage_24h\":2.92582,\"circulating_supply\":390688369.813272,\"total_supply\":390930035.085365,\"max_supply\":null,\"ath\":44.45,\"ath_change_percentage\":-80.24087,\"ath_date\":\"2022-01-17T00:34:41.497Z\",\"atl\":1.16,\"atl_change_percentage\":657.07748,\"atl_date\":\"2020-03-13T02:27:44.591Z\",\"roi\":{\"times\":86.97629936401248,\"currency\":\"usd\",\"percentage\":8697.629936401247},\"last_updated\":\"2024-05-29T10:01:25.670Z\"},{\"id\":\"arbitrum\",\"symbol\":\"arb\",\"name\":\"Arbitrum\",\"image\":\"https://assets.coingecko.com/coins/images/16547/large/photo_2023-03-29_21.47.00.jpeg?1696516109\",\"current_price\":1.18,\"market_cap\":3407278838,\"market_cap_rank\":36,\"fully_diluted_valuation\":11763676965,\"total_volume\":362897692,\"high_24h\":1.22,\"low_24h\":1.16,\"price_change_24h\":-0.02053315138647327,\"price_change_percentage_24h\":-1.71553,\"market_cap_change_24h\":230776539,\"market_cap_change_percentage_24h\":7.26511,\"circulating_supply\":2896440329.0,\"total_supply\":10000000000.0,\"max_supply\":10000000000.0,\"ath\":2.39,\"ath_change_percentage\":-50.87569,\"ath_date\":\"2024-01-12T12:29:59.231Z\",\"atl\":0.744925,\"atl_change_percentage\":57.62793,\"atl_date\":\"2023-09-11T19:40:49.196Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:02.543Z\"},{\"id\":\"immutable-x\",\"symbol\":\"imx\",\"name\":\"Immutable\",\"image\":\"https://assets.coingecko.com/coins/images/17233/large/immutableX-symbol-BLK-RGB.png?1696516787\",\"current_price\":2.28,\"market_cap\":3391621752,\"market_cap_rank\":37,\"fully_diluted_valuation\":4576020821,\"total_volume\":48962541,\"high_24h\":2.34,\"low_24h\":2.26,\"price_change_24h\":-0.02858020120036331,\"price_change_percentage_24h\":-1.23579,\"market_cap_change_24h\":-50327399.27554369,\"market_cap_change_percentage_24h\":-1.46218,\"circulating_supply\":1482345419.3898141,\"total_supply\":2000000000.0,\"max_supply\":2000000000.0,\"ath\":9.52,\"ath_change_percentage\":-76.0499,\"ath_date\":\"2021-11-26T01:03:01.536Z\",\"atl\":0.378055,\"atl_change_percentage\":503.0963,\"atl_date\":\"2022-12-31T07:36:37.649Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:11.054Z\"},{\"id\":\"filecoin\",\"symbol\":\"fil\",\"name\":\"Filecoin\",\"image\":\"https://assets.coingecko.com/coins/images/12817/large/filecoin.png?1696512609\",\"current_price\":5.99,\"market_cap\":3337653201,\"market_cap_rank\":38,\"fully_diluted_valuation\":11742753504,\"total_volume\":154085592,\"high_24h\":6.04,\"low_24h\":5.84,\"price_change_24h\":0.062272,\"price_change_percentage_24h\":1.05064,\"market_cap_change_24h\":38776839,\"market_cap_change_percentage_24h\":1.17546,\"circulating_supply\":557224546.0,\"total_supply\":1960464463.0,\"max_supply\":1960465060.0,\"ath\":236.84,\"ath_change_percentage\":-97.48108,\"ath_date\":\"2021-04-01T13:29:41.564Z\",\"atl\":2.64,\"atl_change_percentage\":125.89491,\"atl_date\":\"2022-12-16T22:45:28.552Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:40.296Z\"},{\"id\":\"kaspa\",\"symbol\":\"kas\",\"name\":\"Kaspa\",\"image\":\"https://assets.coingecko.com/coins/images/25751/large/kaspa-icon-exchanges.png?1696524837\",\"current_price\":0.13963,\"market_cap\":3325293373,\"market_cap_rank\":39,\"fully_diluted_valuation\":3325532430,\"total_volume\":22719198,\"high_24h\":0.141783,\"low_24h\":0.138344,\"price_change_24h\":-0.001551064924849632,\"price_change_percentage_24h\":-1.09863,\"market_cap_change_24h\":-28145420.583497524,\"market_cap_change_percentage_24h\":-0.8393,\"circulating_supply\":23769279654.55,\"total_supply\":23770988444.2437,\"max_supply\":28704026601.0,\"ath\":0.189044,\"ath_change_percentage\":-26.10442,\"ath_date\":\"2024-02-20T06:54:58.731Z\",\"atl\":0.00017105,\"atl_change_percentage\":81569.17184,\"atl_date\":\"2022-05-26T14:42:59.316Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:53.275Z\"},{\"id\":\"mantle\",\"symbol\":\"mnt\",\"name\":\"Mantle\",\"image\":\"https://assets.coingecko.com/coins/images/30980/large/token-logo.png?1696529819\",\"current_price\":1.004,\"market_cap\":3291020614,\"market_cap_rank\":40,\"fully_diluted_valuation\":6269954132,\"total_volume\":68114713,\"high_24h\":1.039,\"low_24h\":1.005,\"price_change_24h\":-0.023348601545070125,\"price_change_percentage_24h\":-2.27176,\"market_cap_change_24h\":-64668694.277915,\"market_cap_change_percentage_24h\":-1.92714,\"circulating_supply\":3264441707.83684,\"total_supply\":6219316794.99,\"max_supply\":6219316794.99,\"ath\":1.54,\"ath_change_percentage\":-34.44312,\"ath_date\":\"2024-04-08T09:45:25.482Z\",\"atl\":0.307978,\"atl_change_percentage\":227.53443,\"atl_date\":\"2023-10-18T02:50:46.942Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:00:34.381Z\"},{\"id\":\"crypto-com-chain\",\"symbol\":\"cro\",\"name\":\"Cronos\",\"image\":\"https://assets.coingecko.com/coins/images/7310/large/cro_token_logo.png?1696507599\",\"current_price\":0.11734,\"market_cap\":3154280351,\"market_cap_rank\":41,\"fully_diluted_valuation\":3535272316,\"total_volume\":10711431,\"high_24h\":0.120206,\"low_24h\":0.11663,\"price_change_24h\":-0.002161503340548959,\"price_change_percentage_24h\":-1.80877,\"market_cap_change_24h\":-45849418.09104729,\"market_cap_change_percentage_24h\":-1.43274,\"circulating_supply\":26766936764.9881,\"total_supply\":30000000000.0,\"max_supply\":null,\"ath\":0.965407,\"ath_change_percentage\":-87.82443,\"ath_date\":\"2021-11-24T15:53:54.855Z\",\"atl\":0.0121196,\"atl_change_percentage\":869.86534,\"atl_date\":\"2019-02-08T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:57.126Z\"},{\"id\":\"stellar\",\"symbol\":\"xlm\",\"name\":\"Stellar\",\"image\":\"https://assets.coingecko.com/coins/images/100/large/Stellar_symbol_black_RGB.png?1696501482\",\"current_price\":0.107961,\"market_cap\":3137631522,\"market_cap_rank\":42,\"fully_diluted_valuation\":5414296223,\"total_volume\":58966424,\"high_24h\":0.109349,\"low_24h\":0.106522,\"price_change_24h\":-0.000773269151425171,\"price_change_percentage_24h\":-0.71115,\"market_cap_change_24h\":-6814531.218114853,\"market_cap_change_percentage_24h\":-0.21672,\"circulating_supply\":28976468319.1208,\"total_supply\":50001786974.3935,\"max_supply\":50001786974.3935,\"ath\":0.875563,\"ath_change_percentage\":-87.68548,\"ath_date\":\"2018-01-03T00:00:00.000Z\",\"atl\":0.00047612,\"atl_change_percentage\":22545.6786,\"atl_date\":\"2015-03-05T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:32.036Z\"},{\"id\":\"the-graph\",\"symbol\":\"grt\",\"name\":\"The Graph\",\"image\":\"https://assets.coingecko.com/coins/images/13397/large/Graph_Token.png?1696513159\",\"current_price\":0.318473,\"market_cap\":3038244791,\"market_cap_rank\":43,\"fully_diluted_valuation\":3446837896,\"total_volume\":93896646,\"high_24h\":0.322895,\"low_24h\":0.308881,\"price_change_24h\":0.00493393,\"price_change_percentage_24h\":1.57362,\"market_cap_change_24h\":51823556,\"market_cap_change_percentage_24h\":1.73531,\"circulating_supply\":9509178822.20243,\"total_supply\":10788004319.0,\"max_supply\":10788004319.0,\"ath\":2.84,\"ath_change_percentage\":-88.80928,\"ath_date\":\"2021-02-12T07:28:45.775Z\",\"atl\":0.052051,\"atl_change_percentage\":510.90981,\"atl_date\":\"2022-11-22T10:05:03.503Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:31.182Z\"},{\"id\":\"first-digital-usd\",\"symbol\":\"fdusd\",\"name\":\"First Digital USD\",\"image\":\"https://assets.coingecko.com/coins/images/31079/large/firstfigital.jpeg?1696529912\",\"current_price\":0.998107,\"market_cap\":2961722711,\"market_cap_rank\":44,\"fully_diluted_valuation\":2975711684,\"total_volume\":6504305805,\"high_24h\":1.006,\"low_24h\":0.988481,\"price_change_24h\":-0.000468718674236479,\"price_change_percentage_24h\":-0.04694,\"market_cap_change_24h\":-123943036.54233074,\"market_cap_change_percentage_24h\":-4.01674,\"circulating_supply\":2964057268.24,\"total_supply\":2978057268.24,\"max_supply\":null,\"ath\":1.089,\"ath_change_percentage\":-8.27637,\"ath_date\":\"2024-05-20T19:42:15.377Z\",\"atl\":0.942129,\"atl_change_percentage\":5.97926,\"atl_date\":\"2023-08-17T21:55:41.478Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:00:24.010Z\"},{\"id\":\"ethena-usde\",\"symbol\":\"usde\",\"name\":\"Ethena USDe\",\"image\":\"https://assets.coingecko.com/coins/images/33613/large/USDE.png?1716355685\",\"current_price\":1.002,\"market_cap\":2906629800,\"market_cap_rank\":45,\"fully_diluted_valuation\":2906629800,\"total_volume\":113588571,\"high_24h\":1.004,\"low_24h\":0.997457,\"price_change_24h\":0.00112794,\"price_change_percentage_24h\":0.11273,\"market_cap_change_24h\":48726005,\"market_cap_change_percentage_24h\":1.70496,\"circulating_supply\":2906068518.20839,\"total_supply\":2906068518.20839,\"max_supply\":null,\"ath\":1.032,\"ath_change_percentage\":-3.08279,\"ath_date\":\"2023-12-20T15:38:34.596Z\",\"atl\":0.965354,\"atl_change_percentage\":3.61639,\"atl_date\":\"2024-04-13T20:11:19.603Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:13.759Z\"},{\"id\":\"blockstack\",\"symbol\":\"stx\",\"name\":\"Stacks\",\"image\":\"https://assets.coingecko.com/coins/images/2069/large/Stacks_Logo_png.png?1709979332\",\"current_price\":1.97,\"market_cap\":2878148728,\"market_cap_rank\":46,\"fully_diluted_valuation\":3579350519,\"total_volume\":48547770,\"high_24h\":2.02,\"low_24h\":1.95,\"price_change_24h\":-0.03149477987019189,\"price_change_percentage_24h\":-1.57307,\"market_cap_change_24h\":-38255077.03753996,\"market_cap_change_percentage_24h\":-1.31172,\"circulating_supply\":1461850232.15417,\"total_supply\":1818000000.0,\"max_supply\":1818000000.0,\"ath\":3.86,\"ath_change_percentage\":-49.05084,\"ath_date\":\"2024-04-01T12:34:58.342Z\",\"atl\":0.04559639,\"atl_change_percentage\":4217.97247,\"atl_date\":\"2020-03-13T02:29:26.415Z\",\"roi\":{\"times\":15.421872094510174,\"currency\":\"usd\",\"percentage\":1542.1872094510175},\"last_updated\":\"2024-05-29T10:01:52.700Z\"},{\"id\":\"bittensor\",\"symbol\":\"tao\",\"name\":\"Bittensor\",\"image\":\"https://assets.coingecko.com/coins/images/28452/large/ARUsPeNQ_400x400.jpeg?1696527447\",\"current_price\":409.1,\"market_cap\":2801383417,\"market_cap_rank\":47,\"fully_diluted_valuation\":8591165189,\"total_volume\":30787867,\"high_24h\":435.46,\"low_24h\":402.72,\"price_change_24h\":-23.86566475868267,\"price_change_percentage_24h\":-5.5121,\"market_cap_change_24h\":-158742157.87617207,\"market_cap_change_percentage_24h\":-5.36268,\"circulating_supply\":6847622.0,\"total_supply\":21000000.0,\"max_supply\":21000000.0,\"ath\":757.6,\"ath_change_percentage\":-46.05738,\"ath_date\":\"2024-03-07T18:45:36.466Z\",\"atl\":30.83,\"atl_change_percentage\":1225.56729,\"atl_date\":\"2023-05-14T08:57:53.732Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:00:26.055Z\"},{\"id\":\"okb\",\"symbol\":\"okb\",\"name\":\"OKB\",\"image\":\"https://assets.coingecko.com/coins/images/4463/large/WeChat_Image_20220118095654.png?1696505053\",\"current_price\":46.35,\"market_cap\":2786905052,\"market_cap_rank\":48,\"fully_diluted_valuation\":10959861088,\"total_volume\":6779964,\"high_24h\":47.38,\"low_24h\":46.19,\"price_change_24h\":-0.9142645887194547,\"price_change_percentage_24h\":-1.93422,\"market_cap_change_24h\":-44444626.436172485,\"market_cap_change_percentage_24h\":-1.56973,\"circulating_supply\":60000000.0,\"total_supply\":235957685.3,\"max_supply\":300000000.0,\"ath\":73.8,\"ath_change_percentage\":-37.20227,\"ath_date\":\"2024-03-14T00:30:12.502Z\",\"atl\":0.580608,\"atl_change_percentage\":7882.46369,\"atl_date\":\"2019-01-14T00:00:00.000Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:59.366Z\"},{\"id\":\"floki\",\"symbol\":\"floki\",\"name\":\"FLOKI\",\"image\":\"https://assets.coingecko.com/coins/images/16746/large/PNG_image.png?1696516318\",\"current_price\":0.00028427,\"market_cap\":2773744780,\"market_cap_rank\":49,\"fully_diluted_valuation\":2861363855,\"total_volume\":1065087515,\"high_24h\":0.00030984,\"low_24h\":0.00028416,\"price_change_24h\":-1.5446769657317e-05,\"price_change_percentage_24h\":-5.1538,\"market_cap_change_24h\":-44570900.412172794,\"market_cap_change_percentage_24h\":-1.58147,\"circulating_supply\":9693785622267.0,\"total_supply\":10000000000000.0,\"max_supply\":10000000000000.0,\"ath\":0.00033651,\"ath_change_percentage\":-15.02088,\"ath_date\":\"2021-11-04T06:58:35.285Z\",\"atl\":8.428e-08,\"atl_change_percentage\":339198.6492,\"atl_date\":\"2021-07-06T01:11:20.438Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:01:29.251Z\"},{\"id\":\"optimism\",\"symbol\":\"op\",\"name\":\"Optimism\",\"image\":\"https://assets.coingecko.com/coins/images/25244/large/Optimism.png?1696524385\",\"current_price\":2.54,\"market_cap\":2765305092,\"market_cap_rank\":50,\"fully_diluted_valuation\":10927412467,\"total_volume\":249387281,\"high_24h\":2.59,\"low_24h\":2.49,\"price_change_24h\":0.00606057,\"price_change_percentage_24h\":0.23957,\"market_cap_change_24h\":8785676,\"market_cap_change_percentage_24h\":0.31872,\"circulating_supply\":1086889963.0,\"total_supply\":4294967296.0,\"max_supply\":4294967296.0,\"ath\":4.84,\"ath_change_percentage\":-47.55381,\"ath_date\":\"2024-03-06T08:35:50.817Z\",\"atl\":0.402159,\"atl_change_percentage\":531.75383,\"atl_date\":\"2022-06-18T20:54:52.178Z\",\"roi\":null,\"last_updated\":\"2024-05-29T10:00:54.155Z\"}]")
            throw;
        }

        return response;
    }

    public async Task<List<CoinMarkets>> GetCoinMarketsByCoinIdsAsync(string[] ids, int perPage)
    {
        List<CoinMarkets> response;
        try
        {
            response = await _coinGeckoClient.CoinsClient.GetCoinMarkets(UsdSymbol, ids, "market_cap_desc", perPage, 1, false, "24h", "layer-1");
        }
        catch (Exception e)
        {
            _logger.LogError(e, "Can not get hot listings");
            throw;
        }

        return response;
    }

    public async Task<TrendingList> GetTrendingListingsAsync()
    {
        TrendingList trendingList;
        try
        {
            trendingList = await _coinGeckoClient.SearchClient.GetSearchTrending();
        }
        catch (Exception e)
        {
            _logger.LogError(e, "Can not get trending listings");
            throw;
        }

        return trendingList;
    }

    public async Task<MarketChartById> GetMarketChartsByCoinIdAsync(string coinId, string vsCurrency, string days)
    {
        MarketChartById marketChartById;
        try
        {
            marketChartById = await _coinGeckoClient.CoinsClient.GetMarketChartsByCoinId(coinId, vsCurrency, days);
        }
        catch (Exception e)
        {
            _logger.LogError(e, "Can not get market charts by coin id, coinId={0}, vsCurrency={1}, days={2}", coinId, vsCurrency, days);
            throw;
        }
        return marketChartById;
    }
}